@model Thought

@{
    ViewData["Title"] = @Model.Title;
}

@await Html.PartialAsync("_PageHeader")

@await Html.PartialAsync("_FlashMessage")

 <!-- Thought Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="well well-lg clearfix">
                    <div class="text-center">
                        <h1 class="section-heading">@Model.Title</h1>
                        <p class="text-muted">
                            Posted by 
                            <a asp-action="Details" 
                                asp-controller="Users" 
                                asp-route-username="@Model.Author.UserName">
                                @Model.Author.FullName
                            </a> 
                            on @Model.CreatedOn.ToString("MM/dd/yyyy") in 
                            <a asp-action="CategoryIndex" 
                                asp-controller="Thoughts" 
                                asp-route-categoryId="@Model.Category">
                                @Model.Category
                            </a>
                        </p>
                    </div>
                    <div class="lead">
                        @Html.Raw(WebUtility.HtmlDecode(Model.Content))
                    </div>
                    <hr />
                </div>
            </div>             
        </div>
    </div>
</article>

<!-- Author info and comments -->
<div class="container">
    <div class="row">  
        <div class="col-md-12">
            <h1 class="text-center">About The Author</h1>

            @await Html.PartialAsync("_UserPartial", @Model.Author)

            @if (Model.DisableComments == true)
            {
                <h3 class="text-center text-muted">Comments are currently disabled for this thought</h3>
            }
            else
            {
                <div class="well">
                    <!-- Comment Form -->     
                    @if (User.Identity.IsAuthenticated)
                    {
                        <!-- Comments Form -->
                        <h4>Leave a Comment:</h4>
                        <form role="form" method="POST" 
                            asp-controller="Comments" 
                            asp-action="Create" 
                            asp-route-thoughtId="@Model.Id"
                            id="comment-form">
                            <input type="hidden" name="returnUrl" value="@Context.Request.Path"
                            <div class="form-group">
                                <textarea class="form-control" rows="4" name="content" id="comment-content"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    }
                    else 
                    {
                        <h4 class="text-center">
                            You must <a asp-action="Login" asp-controller="Account">Log In</a> 
                            or <a asp-action="Register" asp-controller="Account">Register</a> to leave a comment
                        </h4>
                    }
                </div>

                <hr />
                <br />

                <!-- Posted Comments -->
                <!-- Comment -->
                if (!Model.Comments.Any())
                {
                    <h2 class="text-center text-muted">No comments to display</h2>
                }

                @foreach (var comment in @Model.Comments)
                {
                    <div class="media">
                        <a asp-action="Details" asp-controller="Users" asp-route-username="@comment.User.UserName" class="pull-left">
                            <img class="media-object img-responsive user-img" src="@comment.User.Avatar" alt="User Image">
                        </a>
                        <div class="media-body">
                            <h4 class="media-heading">
                                <a asp-action="Details" asp-controller="Users" asp-route-username="@comment.User.UserName">
                                    @comment.User.FullName
                                </a> 
                                <small>
                                    @comment.CreatedOn.ToString("MM/dd/yyyy hh:mm tt")
                                </small>
                            </h4>
                            <div class="comment-content">
                                @comment.Content
                            </div>
                        </div>
                    </div>
                    <hr />
                } 
            }
        </div>
    </div>
</div>


@section Scripts {
    <script type="text/javascript">

    $(document).ready(function(){
        // validate comment submission form
        var $commentForm = $('#comment-form');
        var $content = $('#comment-content');
        $commentForm.on('submit', function(e) {
            //check for validation success
            var validtionSuccess = true;
            if (!$content.val()) {
                $content.addClass('comment-validation-error');
                var errMsg = '<ul class="text-danger" id="name-val-msg"><li>You forgot to write your comment!</li></ul>';
                $commentForm.prepend(errMsg);
                return false;
            }              

            return true;
        });
        
        $content.keypress(function(e) {
            $content.removeClass('comment-validation-error');
            $('#name-val-msg').remove();
        });
    });

    </script>
}